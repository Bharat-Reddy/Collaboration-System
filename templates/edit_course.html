<!DOCTYPE html>
{% extends 'base.html' %}
{% load mptt_tags %}

{% block breadcrumb %}
  <li class="breadcrumb-item active"><a href="{% url 'community_view' course.community.pk %}"> {{ course.community.name }} </a></li>
  <li class="breadcrumb-item active">{{ course.course.name }} </li>
{% endblock %}
{% block content %}
<div class="container-fluid ">
  <div class="row">
    <div class="col-sm-4">
      <div>
      <ul class="nav nav-tabs">
        <li class="nav-item active">
          <a class="nav-link " href="{% url 'course_view' course.course.pk %}">View</a>
        </li>
        {% if user.is_authenticated %}
        <li class="nav-item ">
          <a class="nav-link " href="#">Edit</a>
        </li>
        {% endif %}
      </ul>
      </div>
      <br/>
      <div class="blog-item">
        <h2><a href="#">{{ course.course.name }} </a></h2>
            <ul>
                {% recursetree topics %}
                    <li><p>
                      <form id="updatetopic" method="post" action="{% url 'course_edit' course.course.pk %}">
                        {% csrf_token %}
                        <input type='hidden' name='status' value='update'>
                        <input type='hidden' name='nodeid' value = {{node.id}}>
                        <input type='text' id='txt{{node.id}}' name='name{{node.id}}' onclick='saveTopic({{node.id}})' style='border:0px' value = {{node.name}} />
                        <!--<span id='txt{{node.id}}' name='name' onsubmit="Edit({{node.id}})" contentEditable='true' >{{node.name}}</span>-->
                      </form>
                        {% if not node.is_leaf_node %}
                            <ul class="children">
                                {{ children }}
                            </ul>
                        {% endif %}
                    </p></li>
                {% endrecursetree %}
            </ul>
         <form id="newtopic" method="post" novalidate>
             {% csrf_token %}
             <table>
               {{ form.as_p }}
             </table>
             {% csrf_token %}
             <input type="hidden" name="status" value="addtopic">
             <button type="submit">Save</button>
           </form>

      </div>
    </div>
    <div class="col-sm-8"><br/><br/>
      content
    </div>
  </div>
</div>

{% endblock %}

{% block javascript %}
<script>
/*function Edit(nodeid) {
      document.getElementById("txt"+nodeid).contentEditable = true;
      if(! (document.getElementById("btn"+nodeid)) ){
          var node = document.createElement("BUTTON");
          node.setAttribute('id', "btn"+nodeid);
          node.innerHTML = "Save";
          node.onClick = "saveTopic("+nodeid+")";
          document.getElementById("txt"+nodeid).appendChild(node);
      }
}*/
function saveTopic(nodeid) {

      //document.getElementById("txt"+nodeid).contentEditable = false;
      //var element = document.getElementById("btn"+nodeid);
      //element.parentNode.removeChild(element);

      document.getElementById("txt"+nodeid).addEventListener("keydown", function(e) {
          if (!e) { var e = window.event; }
          e.preventDefault(); // sometimes useful

          // Enter is pressed
          if (e.keyCode == 13) { submitForm(); }
      }, false);

      function submitForm(){
          document.updatetopic.submit();
          document.updatetopic.method='post';
      }
</script>

{% endblock %}
